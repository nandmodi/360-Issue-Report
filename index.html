<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>360 Issue Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://spyne-prod-ai.s3.us-east-1.amazonaws.com/ai-dataset/2025/favicon.ico" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f8f9fa; }
    .header-bar { position: fixed; top: 0; left: 0; right: 0; z-index: 10000; background: #fff; padding: 10px 0; text-align: center; font-weight: bold; font-size: 22px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
    .upload-section { position: fixed; top: 50px; left: 0; right: 0; background: #fff; z-index: 10001; padding: 10px 20px; display: flex; flex-wrap: wrap; gap: 20px; align-items: center; justify-content: center; border-bottom: 1px solid #ccc; }
    .filters { position: fixed; top: 100px; left: 0; right: 0; background: #f8f9fa; z-index: 10000; padding: 10px 20px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; border-bottom: 1px solid #ccc; }
    .filters select, .filters button { padding: 6px 10px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc; }
    .filters button { background: #007bff; color: white; border: none; cursor: pointer; }
    .summary-bar { position: fixed; top: 160px; left: 0; right: 0; background: #e2e6ea; z-index: 9998; padding: 10px 20px; display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ccc; border-bottom: 2px solid #ccc; }
    .main-content { margin-top: 230px; padding: 0 20px; }
    .chart-row { display: flex; gap: 20px; justify-content: space-between; margin: 20px 0; }
    .chart-box { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .issue { flex: 2; }
    .pie { flex: 1; }
    .summary-tables { display: flex; gap: 20px; margin-bottom: 20px; }
    .half-width-box { flex: 1; background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
    .enterprise-scroll-limit { max-height: 400px; overflow-y: auto; flex-grow: 1; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    .bottom-row { display: flex; gap: 20px; margin-bottom: 20px; }
    .table-box { flex: 1; max-height: 320px; overflow-y: auto; background: #fff; padding: 10px; border-radius: 10px; }
    .iframe-box { flex: 2; background: #fff; padding: 10px; border-radius: 10px; }
    iframe { width: 100%; height: 300px; border: none; border-radius: 10px; }
    .clickable { color: blue; text-decoration: underline; cursor: pointer; }
    #lastUpdated { text-align: right; font-size: 14px; padding: 5px 20px; color: #666; }
    #noDataMessage { text-align: center; padding: 20px; display: none; color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="header-bar">360 Issue Dashboard</div>
  <div class="upload-section">
    <label><b>Upload QC File:</b> <input type="file" id="qcFile" accept=".csv" /></label>
    <label><b>Upload Total File:</b> <input type="file" id="totalFile" accept=".csv" /></label>
    <button onclick="manualLoad()" style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px;">Load Data</button>
  </div>
  <div class="filters">
    <select id="monthFilter"><option value="">Month</option></select>
    <select id="severityFilter"><option value="">Severity</option></select>
    <select id="issueFilter"><option value="">Issue</option></select>
    <select id="enterpriseFilter"><option value="">Enterprise</option></select>
    <select id="productTypeFilter"><option value="">Product Type</option></select>
    <select id="qcFilter"><option value="">QC</option></select>
    <button onclick="resetFilters()">Reset</button>
  </div>
  <div class="summary-bar">
    <div>Total Marked Spin: <span id="markedSpin">0</span></div>
    <div>
      <button onclick="applyFilters()" title="Refresh" style="background:none;border:none;cursor:pointer;font-size:18px;">ðŸ”„</button>
      <button onclick="exportTableToCSV('spin-data.csv')" title="Export CSV" style="background:none;border:none;cursor:pointer;font-size:18px;">ðŸ“¤</button>
    </div>
    <div>Total Received Spin: <span id="receivedSpin">0</span></div>
  </div>
  <div class="main-content">
    <div class="chart-row">
      <div class="chart-box issue"><canvas id="issueChart"></canvas></div>
      <div class="chart-box pie"><canvas id="severityPie"></canvas></div>
    </div>
    <div class="summary-tables">
      <div class="half-width-box">
        <h3>Issue % by Issue</h3>
        <table id="issueSummary">
          <thead><tr><th>Issue</th><th>Total</th><th>Blocker</th><th>High</th><th>Low</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="half-width-box enterprise-scroll-limit">
        <h3>Issue % by Enterprise</h3>
        <table id="enterpriseSummary">
          <thead><tr><th>Enterprise</th><th>Issue %</th><th>Blocker</th><th>High</th><th>Low</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div class="bottom-row">
      <div class="table-box">
        <table id="spinTable">
          <thead><tr><th>Spin ID</th><th>Issue</th><th>Severity</th><th>Enterprise</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="iframe-box">
        <iframe id="spinIframe" title="Spin Preview"></iframe>
      </div>
    </div>
    <div id="lastUpdated"></div>
    <div id="noDataMessage">No data found for selected filters.</div>
  </div>
  <script>
    // Insert the entire JS logic from previous messages
    // Due to length, please let me know if you want it embedded directly here
  </script>
</body>
</html>
